{"version":3,"file":"preact-router.js","sources":["../src/util.js","../src/historyPushEvent.js","../src/index.js"],"sourcesContent":["\nconst EMPTY = {};\n\nexport function exec(url, route, opts=EMPTY) {\n\tlet reg = /(?:\\?([^#]*))?(#.*)?$/,\n\t\tc = url.match(reg),\n\t\tmatches = {},\n\t\tret;\n\tif (c && c[1]) {\n\t\tlet p = c[1].split('&');\n\t\tfor (let i=0; i<p.length; i++) {\n\t\t\tlet r = p[i].split('=');\n\t\t\tmatches[decodeURIComponent(r[0])] = decodeURIComponent(r.slice(1).join('='));\n\t\t}\n\t}\n\turl = segmentize(url.replace(reg, ''));\n\troute = segmentize(route || '');\n\tlet max = Math.max(url.length, route.length);\n\tfor (let i=0; i<max; i++) {\n\t\tif (route[i] && route[i].charAt(0)===':') {\n\t\t\tmatches[route[i].substring(1)] = decodeURIComponent(url[i] || '');\n\t\t}\n\t\telse {\n\t\t\tif (route[i]!==url[i]) {\n\t\t\t\tret = false;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t}\n\tif (opts.default!==true && ret===false) return false;\n\treturn matches;\n}\n\nexport function pathRankSort(a, b) {\n\tlet aAttr = a.attributes || EMPTY,\n\t\tbAttr = b.attributes || EMPTY;\n\tif (aAttr.default) return 1;\n\tif (bAttr.default) return -1;\n\tlet diff = rank(aAttr.path) - rank(bAttr.path);\n\treturn diff || (aAttr.path.length - bAttr.path.length);\n}\n\nexport function segmentize(url) {\n\treturn strip(url).split('/');\n}\n\nexport function rank(url) {\n\treturn (strip(url).match(/\\/+/g) || '').length;\n}\n\nexport function strip(url) {\n\treturn url.replace(/(^\\/+|\\/+$)/g, '');\n}\n","if (typeof window !== 'undefined') {\n  (function(history){\n    let pushState = history.pushState;\n    let replaceState = history.replaceState;\n\n    history.pushState = function(state) {\n      pushState.apply(history, arguments);\n\n      if (typeof history.onpushstate == \"function\") {\n        history.onpushstate({state: state});\n      }\n      return pushState.apply(history, arguments);\n    };\n    history.replaceState = function(state) {\n      if (typeof history.onreplacestate == \"function\") {\n        history.onreplacestate({state: state});\n      }\n\n      return replaceState.apply(history, arguments);\n    };\n  })(window.history);\n}\n","import { h, Component } from 'preact';\nimport { exec, pathRankSort } from './util';\nimport './historyPushEvent';\n\n// const routers = [];\n\nfunction route(url, replace=false) {\n\tif (typeof url!=='string' && url.url) {\n\t\treplace = url.replace;\n\t\turl = url.url;\n\t}\n\tif (history) {\n\n\t\tif (replace===true) {\n\t\t\thistory.replaceState(null, null, url);\n\t\t}\n\t\telse {\n\t\t\thistory.pushState(null, null, url);\n\t\t}\n\t}\n\t// routeTo(url);\n}\n//\n// function routeTo(url) {\n// \trouters.forEach( router => router.routeTo(url) );\n// }\n\n// function getCurrentUrl(url) {\n// \treturn typeof location!=='undefined' ?\n// \t\t`${location.pathname || ''}${location.search || ''}` :\n// \t\turl || '';\n// }\n//\n// if (typeof addEventListener==='function') {\n// \taddEventListener('popstate', () => routeTo(getCurrentUrl()));\n// }\n\n\nfunction handleLinkClick(e) {\n\troute(this.getAttribute('href'));\n\tif (e.stopImmediatePropagation) e.stopImmediatePropagation();\n\te.stopPropagation();\n\te.preventDefault();\n\treturn false;\n}\n\n\nconst Link = ({ children, ...props }) => (\n\t<a {...props} onClick={ handleLinkClick }>{ children }</a>\n);\n\n\nclass Router extends Component {\n\t// constructor(props) {\n\t// \tsuper();\n\t// \t// set initial url\n\t// \tthis.state.url = getCurrentUrl(props && props.url);\n\t// }\n\t//\n\t// routeTo(url) {\n\t// \tthis.setState({ url });\n\t// }\n\t//\n\t// componentWillMount() {\n\t// \trouters.push(this);\n\t// }\n\t//\n\t// componentWillUnmount() {\n\t// \trouters.splice(routers.indexOf(this), 1);\n\t// }\n\tcomponentDidMount(){\n\t\tthis.lastActive = this.getActive(this.props);\n\t}\n\n\tcomponentDidUpdate(prevProps, prevState){\n\t\tthis.lastActive = this.getActive(this.props);\n\t\tif(this.props.transition){\n\t\t\tif(this.transitionTimeout) clearTimeout(this.transitionTimeout);\n\t\t\tthis.transitionTimeout = setTimeout(()=>{\n\t\t\t\tthis.setState({transitionEnd: true})\n\t\t\t}, this.props.transition);\n\t\t}\n\t}\n\n\tcomponentWillReceiveProps(props){\n\t\tif(props.transition){\n\t\t\tthis.setState({transitionEnd: false});\n\t\t}\n\t}\n\n\tgetActive({ children, onChange, url }) {\n\t\tlet active = children.slice().sort(pathRankSort).filter( ({ attributes }) => {\n\t\t\tlet path = attributes.path,\n\t\t\t\tmatches = exec(url, path, attributes);\n\t\t\tif (matches) {\n\t\t\t\tattributes.url = url;\n\t\t\t\tattributes.matches = matches;\n\t\t\t\t// copy matches onto props\n\t\t\t\tfor (let i in matches) {\n\t\t\t\t\tif (matches.hasOwnProperty(i)) {\n\t\t\t\t\t\tattributes[i] = matches[i];\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\treturn true;\n\t\t\t}\n\t\t});\n\t\treturn active[0] || null;\n\t}\n\n\trender(props, {transitionEnd}) {\n\t\tconst url = props.url;\n\t\tconst active = this.getActive(props);\n\t\tconst children = [active];\n\t\tif(props.transition && !transitionEnd && this.lastActive){\n\t\t\tactive.attributes.transitionClass = 'transition-in';\n\t\t\tthis.lastActive.attributes.transitionClass = 'transition-out';\n\t\t\tchildren.unshift(this.lastActive);\n\t\t}\n\t\tlet previous = this.previousUrl;\n\t\tif (url!==previous) {\n\t\t\tthis.previousUrl = url;\n\t\t\tif (typeof onChange==='function') {\n\t\t\t\tonChange({\n\t\t\t\t\trouter: this,\n\t\t\t\t\turl,\n\t\t\t\t\tprevious,\n\t\t\t\t\tactive\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t\treturn <div class={props.class + (props.transition && !transitionEnd ? ' transition' : '')}>{children}</div>;\n\t}\n}\n\n\nconst Route = ({ component:RoutedComponent, url, matches }) => (\n\t<RoutedComponent {...{url, matches}} />\n);\n\n\nRouter.route = route;\nRouter.Router = Router;\nRouter.Route = Route;\nRouter.Link = Link;\n\nexport default Router;\n"],"names":["h","Component"],"mappings":"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"}